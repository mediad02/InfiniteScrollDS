// ==UserScript==
// @name         ODGQuick Copy Button
// @namespace    http://tampermonkey.net/
// @version      0.60
// @description  try to take over the world!
// @author       Adolfo Medina
// @match        https://www.odgbymcg.com/treatment
// @icon         https://www.google.com/s2/favicons?sz=64&domain=odgbymcg.com
// @tag          productivity
// @grant        GM_setClipboard
// @updateURL    https://raw.githubusercontent.com/mediad02/InfiniteScrollDS/main/ODGQuickCopyButton.user.js
// @downloadURL  https://raw.githubusercontent.com/mediad02/InfiniteScrollDS/main/ODGQuickCopyButton.user.js
// ==/UserScript==
"use strict";(()=>{function c(e,t,n){return Array.from(e.querySelectorAll(t)).find(o=>o.textContent?.includes(n))}function l(e){let t=e.querySelector("div.modified-date")?.textContent?.trim()??"",n=e.querySelector("h2.tab-header")?.textContent?.trim()??"",o=c(e,".treatment-list-label","Treatment type:"),i=o?o.parentElement?.textContent?.trim()??"":"",d=c(e,".treatment-list-label","Body system:"),a=d?d.parentElement?.textContent?.trim()??"":"",r=c(e,".treatment-list-label","Related Topics:"),s="";if(r&&r.nextSibling instanceof Element){let y=Array.from(r.nextSibling.querySelectorAll?.("a.related-topic")??[]).map(f=>f.textContent?.trim()??"");s=r.textContent?.trim()+" "+y.join(",<br>").trim()}return{modifiedDate:t,treatmentType:i,bodySystem:a,relatedTopics:s,header:n}}async function m(e){let t=e.cloneNode(!0),n=l(t),o=t.querySelector("article div.row div.col-md-11 div.recommendation-section h3.page-subheader")?.firstChild;o&&typeof o.textContent=="string"&&(o.textContent+=" - "),u(t);let i=t.outerHTML,a=t.querySelector("div.recommendation-section h3.page-subheader")?.textContent?.includes("See Reference"),r;a?r=`<b><div>ODG by MCG</div>${n.modifiedDate}<div>${n.header}</div></b>${n.treatmentType}${n.relatedTopics}${i}`:r=`<b><div>ODG by MCG</div>${n.modifiedDate}<div>${n.header}</div></b>${n.treatmentType}${i}`;try{await navigator.clipboard.write([new window.ClipboardItem({"text/html":new Blob([r],{type:"text/html"})})]),console.log("HTML copied to clipboard successfully")}catch(s){console.error("Failed to copy HTML to clipboard:",s)}}async function p(e){let t=e.cloneNode(!0),n=l(t),o=t.querySelector("article div.row div.col-md-11 div.recommendation-section h3.page-subheader")?.firstChild;o&&typeof o.textContent=="string"&&(o.textContent+=" - "),u(t);let i=t.outerHTML,a=t.querySelector("div.recommendation-section h3.page-subheader")?.textContent?.includes("See Reference"),r;a?r=`<b><div>ODG by MCG</div>${n.modifiedDate}<div>${n.header}</div></b>${n.treatmentType}${n.relatedTopics}${i}`:r=`<b><div>ODG by MCG</div>${n.modifiedDate}<div>${n.header}</div></b>${n.treatmentType}${i}`,r=r.replace(/\((<a.*?class="citation-link-trigger">.*?<\/a>)\)\s+/gs,"");try{await navigator.clipboard.write([new window.ClipboardItem({"text/html":new Blob([r],{type:"text/html"})})]),console.log("HTML copied to clipboard successfully")}catch(s){console.error("Failed to copy HTML to clipboard:",s)}}function u(e){e.querySelector("div.recommendation-section")?.previousElementSibling?.remove(),[".copy-button-container","h2.tab-header","div.proc-code-section","div.modified-date"].forEach(t=>{e.querySelector(t)?.remove()}),e.querySelectorAll("article div.row div.col-md-11 div.col-md-12").forEach(t=>{!(e.querySelector("div.recommendation-section h3.page-subheader")?.textContent||"").includes("See Reference")&&(t.innerHTML.includes("<p>Citations</p>")||(t.textContent?.includes("Body system:")??!1)||(t.textContent?.includes("Related Topics:")??!1)||(t.textContent?.includes("Treatment type:")??!1))&&t.remove(),((t.textContent?.includes("Body system:")??!1)||(t.textContent?.includes("Related Topics:")??!1))&&t.remove()})}function b(){document.querySelectorAll("h2.tab-header").forEach(e=>{let t=C(),n=v(),o=document.createElement("div");o.className="d-flex gap-2 mt-2 copy-button-container",o.style.marginTop="1rem",e.parentElement?.prepend(o),o.append(t),o.append(" "),o.append(n)})}function C(){let e=document.createElement("button");return e.textContent="Copy",e.className="btn btn-primary",e.type="button",e.addEventListener("click",async t=>{let n=t.target.parentElement?.parentElement;n&&await m(n),e.textContent="Copied!",e.classList.remove("btn-primary"),e.classList.add("btn-success"),setTimeout(()=>{e.textContent="Copy",e.classList.remove("btn-success"),e.classList.add("btn-primary")},2e3)}),e}function v(){let e=document.createElement("button");return e.textContent="Sedg Copy",e.className="btn btn-secondary",e.type="button",e.addEventListener("click",async t=>{let n=t.target.parentElement?.parentElement;n&&await p(n),e.textContent="Copied!",e.classList.remove("btn-secondary"),e.classList.add("btn-success"),setTimeout(()=>{e.textContent="Sedg Copy",e.classList.remove("btn-success"),e.classList.add("btn-secondary")},2e3)}),e}window.addEventListener("load",b);})();
